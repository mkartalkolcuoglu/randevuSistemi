// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                  String   @id @default(cuid())
  businessName        String
  slug                String   @unique
  domain              String   @unique
  username            String   @unique
  password            String
  ownerName          String
  ownerEmail         String
  phone              String?
  plan               String   @default("Standard")
  status             String   @default("active")
  address            String?
  businessType       String   @default("other")
  businessDescription String?
  monthlyRevenue     Int      @default(0)
  appointmentCount   Int      @default(0)
  customerCount      Int      @default(0)
  createdAt          DateTime @default(now())
  lastLogin          DateTime?
  
  // Subscription package fields
  subscriptionPlan   String?  // "trial", "monthly", "yearly"
  subscriptionStart  DateTime?
  subscriptionEnd    DateTime?
  
  // JSON fields for complex data
  workingHours       String?  // JSON string
  theme              String?  // JSON string
  
  @@map("tenants")
}

model Integration {
  id          String   @id @default(cuid())
  name        String
  type        String
  status      String   @default("active")
  description String?
  tenantCount Int      @default(0)
  lastUpdate  DateTime @default(now())
  
  @@map("integrations")
}

model SupportTicket {
  id          String   @id @default(cuid())
  tenantId    String
  tenantName  String
  subject     String
  description String
  priority    String   @default("medium")
  status      String   @default("open")
  assignedTo  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@map("support_tickets")
}

model SlaMetric {
  id                    String @id @default(cuid())
  tenantId             String
  tenantName           String
  uptime               Float
  responseTime         Float
  ticketResolutionTime Float
  month                String
  
  @@map("sla_metrics")
}

model Admin {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String   // MD5 hashed
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastLogin DateTime?
  
  @@map("admins")
}

model Appointment {
  id           String   @id @default(cuid())
  tenantId     String
  customerId   String
  customerName String
  customerPhone String?
  customerEmail String?
  serviceId    String
  serviceName  String
  staffId      String
  staffName    String
  date         String
  time         String
  status       String   @default("scheduled")
  notes        String?
  price        Float?
  duration     Int?     // in minutes
  paymentType  String   @default("cash")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@map("appointments")
}

model Customer {
  id          String   @id @default(cuid())
  tenantId    String
  firstName   String
  lastName    String
  email       String
  phone       String?
  birthDate   DateTime?
  gender      String?
  address     String?
  notes       String?
  status      String   @default("active")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([tenantId, email])
  @@map("customers")
}

model SubscriptionPackage {
  id           String   @id @default(cuid())
  name         String   // "15 Günlük Deneme", "Aylık Premium"
  slug         String   @unique // "trial", "monthly", "yearly"
  durationDays Int      // 15, 30, 365
  price        Float    @default(0) // 0 = ücretsiz
  isActive     Boolean  @default(true)
  isFeatured   Boolean  @default(false) // Öne çıkan paket (özel badge)
  displayOrder Int      @default(0)
  features     String?  @db.Text // JSON array: ["Sınırsız randevu", "100 müşteri"]
  description  String?  // Kısa açıklama
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@map("subscription_packages")
}

model Page {
  id        String   @id @default(cuid())
  slug      String   @unique // "hakkimizda", "gizlilik"
  title     String
  content   String   @db.Text
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("pages")
}
